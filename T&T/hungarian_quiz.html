<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hungarian Vocabulary Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }

        .quiz-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.12);
            padding: 48px;
            max-width: 800px;
            width: 100%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        h1 {
            color: #1a1a1a;
            margin-bottom: 12px;
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: #6b7280;
            margin-bottom: 40px;
            font-size: 1.125rem;
            font-weight: 400;
        }

        /* Settings Panel */
        .settings-panel {
            background: #f8fafc;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            border: 1px solid #e5e7eb;
        }

        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .settings-row:last-child {
            margin-bottom: 0;
        }

        .setting-label {
            font-weight: 500;
            color: #374151;
            font-size: 0.95rem;
        }

        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
            background: #d1d5db;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle.active {
            background: #3b82f6;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 10px;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle.active .toggle-slider {
            transform: translateX(20px);
        }

        .difficulty-selector {
            display: flex;
            gap: 8px;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 12px;
        }

        .difficulty-option {
            padding: 8px 16px;
            border-radius: 8px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s ease;
        }

        .difficulty-option.active {
            background: white;
            color: #1e293b;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Menu Grid */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .category-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 32px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
            border-color: #3b82f6;
        }

        .category-icon {
            font-size: 2.5rem;
            margin-bottom: 16px;
            filter: grayscale(0.3);
        }

        .category-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .category-description {
            color: #6b7280;
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .category-count {
            background: #f3f4f6;
            color: #374151;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }

        /* Stats Display */
        .stats-container {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-bottom: 32px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 4px;
        }

        .score-display {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            padding: 20px 32px;
            border-radius: 16px;
            margin-bottom: 24px;
            display: inline-block;
        }

        .score-text {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
        }

        /* Question Card */
        .question-card {
            background: #fafafa;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
        }

        .question {
            font-size: 1.5rem;
            color: #1f2937;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .english-phrase {
            font-size: 1.375rem;
            color: #3b82f6;
            margin-bottom: 32px;
            font-weight: 500;
            background: #eff6ff;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
        }

        /* Input Styling */
        input[type="text"] {
            width: 100%;
            padding: 16px 20px;
            font-size: 1.125rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
            background: white;
            font-weight: 500;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* Button Styling */
        .btn {
            background: #1f2937;
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 6px;
            font-weight: 600;
            letter-spacing: 0.01em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(31, 41, 55, 0.3);
        }

        .btn-primary {
            background: #3b82f6;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        /* Feedback */
        .feedback {
            margin-top: 24px;
            padding: 20px;
            border-radius: 12px;
            font-weight: 500;
            font-size: 1rem;
        }

        .feedback.correct {
            background: #ecfdf5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .feedback.incorrect {
            background: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 32px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .progress-bar {
            background: #f3f4f6;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        /* Timer */
        .timer {
            background: #fef3c7;
            color: #92400e;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: inline-block;
        }

        .timer.warning {
            background: #fee2e2;
            color: #991b1b;
            animation: pulse 1s infinite;
        }

        /* Completion */
        .completion {
            background: #f0f9ff;
            color: #0c4a6e;
            padding: 40px;
            border-radius: 20px;
            border: 1px solid #bae6fd;
        }

        .completion h2 {
            margin-bottom: 20px;
            font-size: 2rem;
        }

        /* Category Badge */
        .current-category {
            background: #f1f5f9;
            color: #334155;
            padding: 12px 24px;
            border-radius: 24px;
            margin-bottom: 24px;
            font-weight: 600;
            display: inline-block;
            border: 1px solid #e2e8f0;
        }

        /* Hint System */
        .hint-container {
            margin-top: 16px;
            padding: 16px;
            background: #fffbeb;
            border: 1px solid #fbbf24;
            border-radius: 12px;
            font-size: 0.9rem;
            color: #92400e;
        }

        /* Streak Counter */
        .streak-counter {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-left: 12px;
        }

        .hidden {
            display: none;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .quiz-container {
                padding: 32px 24px;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-container {
                gap: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .settings-row {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>üá≠üá∫ Magyar Quiz</h1>
        <p class="subtitle">Advanced Hungarian vocabulary training platform</p>

        <!-- Start Menu -->
        <div id="start-menu">
            <!-- Settings Panel -->
            <div class="settings-panel">
                <div class="settings-row">
                    <span class="setting-label">Timer Mode</span>
                    <div class="toggle" id="timer-toggle" onclick="toggleTimer()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Show Hints</span>
                    <div class="toggle active" id="hints-toggle" onclick="toggleHints()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Difficulty Level</span>
                    <div class="difficulty-selector">
                        <button class="difficulty-option active" onclick="setDifficulty('easy')">Easy</button>
                        <button class="difficulty-option" onclick="setDifficulty('medium')">Medium</button>
                        <button class="difficulty-option" onclick="setDifficulty('hard')">Hard</button>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-number" id="total-questions">0</div>
                    <div class="stat-label">Questions Answered</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="accuracy-rate">0%</div>
                    <div class="stat-label">Accuracy Rate</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="best-streak">0</div>
                    <div class="stat-label">Best Streak</div>
                </div>
            </div>

            <!-- Category Selection -->
            <div class="menu-grid">
                <div class="category-card" onclick="startQuiz('greetings')">
                    <div class="category-icon">üëã</div>
                    <div class="category-title">Greetings</div>
                    <div class="category-description">Basic greetings and polite expressions</div>
                    <div class="category-count">15 phrases</div>
                </div>
                
                <div class="category-card" onclick="startQuiz('numbers')">
                    <div class="category-icon">üî¢</div>
                    <div class="category-title">Numbers</div>
                    <div class="category-description">Learn to count from 1 to 100</div>
                    <div class="category-count">25 numbers</div>
                </div>
                
                <div class="category-card" onclick="startQuiz('daily')">
                    <div class="category-icon">üè†</div>
                    <div class="category-title">Daily Life</div>
                    <div class="category-description">Common household and daily expressions</div>
                    <div class="category-count">20 phrases</div>
                </div>
                
                <div class="category-card" onclick="startQuiz('time')">
                    <div class="category-icon">‚è∞</div>
                    <div class="category-title">Time & Date</div>
                    <div class="category-description">Days, months, and time expressions</div>
                    <div class="category-count">18 phrases</div>
                </div>
                
                <div class="category-card" onclick="startQuiz('random')">
                    <div class="category-icon">üé≤</div>
                    <div class="category-title">Mixed Practice</div>
                    <div class="category-description">Random selection from all categories</div>
                    <div class="category-count">20 questions</div>
                </div>
                
                <div class="category-card" onclick="startQuiz('all')">
                    <div class="category-icon">üìö</div>
                    <div class="category-title">Complete Test</div>
                    <div class="category-description">Full vocabulary assessment</div>
                    <div class="category-count">78 questions</div>
                </div>
            </div>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-section" class="hidden">
            <div class="current-category" id="current-category"></div>
            
            <div class="score-display">
                <span class="score-text">Score: <span id="score">0</span> / <span id="total">0</span></span>
                <span class="streak-counter" id="streak-display">üî• 0</span>
            </div>

            <div id="timer-display" class="timer hidden">‚è±Ô∏è <span id="time-left">30</span>s</div>

            <div class="progress-container">
                <div class="progress-label">
                    <span>Progress</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
            </div>

            <div id="quiz-content" class="slide-in">
                <div class="question-card">
                    <div class="question">How do you say this in Hungarian?</div>
                    <div class="english-phrase" id="english-phrase"></div>
                    <input type="text" id="answer-input" placeholder="Type your answer here..." autocomplete="off">
                    
                    <div id="hint-container" class="hint-container hidden">
                        üí° <strong>Hint:</strong> <span id="hint-text"></span>
                    </div>
                    
                    <div style="margin-top: 24px;">
                        <button class="btn btn-primary" onclick="checkAnswer()">Submit Answer</button>
                        <button class="btn btn-secondary" onclick="skipQuestion()">Skip Question</button>
                        <button class="btn btn-secondary" id="hint-btn" onclick="showHint()">Show Hint</button>
                    </div>
                </div>
                
                <div id="feedback" class="feedback hidden"></div>
                <button id="next-btn" class="btn btn-success hidden" onclick="nextQuestion()">Continue ‚Üí</button>
            </div>

            <button class="btn btn-secondary" onclick="backToMenu()">‚Üê Back to Menu</button>
        </div>

        <!-- Completion Screen -->
        <div id="completion" class="completion hidden">
            <h2>üéâ Quiz Complete!</h2>
            <p id="final-score"></p>
            <div style="margin-top: 24px;">
                <button class="btn btn-primary" onclick="restartQuiz()">Try Again</button>
                <button class="btn btn-secondary" onclick="backToMenu()">‚Üê Main Menu</button>
            </div>
        </div>
    </div>

    <script>
        const questionSets = {
            greetings: [
                { english: "Thank you", hungarian: "k√∂sz√∂n√∂m", alternatives: ["koszonom"], hint: "Sounds like 'curse-oh-nom'" },
                { english: "You're welcome", hungarian: "sz√≠vesen", alternatives: ["szivesen"], hint: "Means 'with pleasure'" },
                { english: "Hi / Hello", hungarian: "szia", alternatives: ["hello", "szervusz"], hint: "Informal greeting, sounds like 'see-ya'" },
                { english: "How are you?", hungarian: "hogy vagy?", alternatives: ["hogy vagy", "hogy van?", "hogy van"], hint: "Literally 'how are you?'" },
                { english: "I am fine", hungarian: "j√≥l vagyok", alternatives: ["jol vagyok"], hint: "J√≥l = well, good" },
                { english: "Good morning", hungarian: "j√≥ reggelt", alternatives: ["jo reggelt"], hint: "J√≥ = good, reggelt = morning" },
                { english: "Good evening", hungarian: "j√≥ est√©t", alternatives: ["jo estet"], hint: "Est√©t = evening" },
                { english: "Good night", hungarian: "j√≥ √©jszak√°t", alternatives: ["jo ejszakat", "j√≥ ejszakat", "jo √©jszak√°t"], hint: "√âjszak√°t = night" },
                { english: "Please", hungarian: "k√©rem", alternatives: ["kerem"], hint: "Formal way to say please" },
                { english: "Excuse me", hungarian: "eln√©z√©st", alternatives: ["elnezest"], hint: "Used to get attention or apologize" },
                { english: "I'm sorry", hungarian: "sajn√°lom", alternatives: ["sajnalom"], hint: "Expression of regret" },
                { english: "Yes", hungarian: "igen", alternatives: [], hint: "Pronounced 'EE-gen'" },
                { english: "No", hungarian: "nem", alternatives: [], hint: "Simple and short" },
                { english: "My name is...", hungarian: "a nevem...", alternatives: ["nevem"], hint: "Nevem = my name" },
                { english: "Goodbye", hungarian: "viszl√°t", alternatives: ["viszlat"], hint: "Common farewell" }
            ],
            
            numbers: [
                { english: "One", hungarian: "egy", alternatives: [], hint: "Sounds like 'edge'" },
                { english: "Two", hungarian: "kett≈ë", alternatives: ["ketto"], hint: "Similar to 'get-toe'" },
                { english: "Three", hungarian: "h√°rom", alternatives: ["harom"], hint: "Sounds like 'ha-rome'" },
                { english: "Four", hungarian: "n√©gy", alternatives: ["negy"], hint: "Like 'neigh' (horse sound)" },
                { english: "Five", hungarian: "√∂t", alternatives: ["ot"], hint: "Very short, like 'urt'" },
                { english: "Six", hungarian: "hat", alternatives: [], hint: "Same as English 'hot'" },
                { english: "Seven", hungarian: "h√©t", alternatives: ["het"], hint: "Like 'hate'" },
                { english: "Eight", hungarian: "nyolc", alternatives: [], hint: "Sounds like 'nyolts'" },
                { english: "Nine", hungarian: "kilenc", alternatives: [], hint: "Pronounced 'KEE-lents'" },
                { english: "Ten", hungarian: "t√≠z", alternatives: ["tiz"], hint: "Like 'tease'" },
                { english: "Twenty", hungarian: "h√∫sz", alternatives: ["husz"], hint: "Sounds like 'hoose'" },
                { english: "Thirty", hungarian: "harminc", alternatives: [], hint: "HAR-mints" },
                { english: "Forty", hungarian: "negyven", alternatives: [], hint: "NEIGH-ven" },
                { english: "Fifty", hungarian: "√∂tven", alternatives: ["otven"], hint: "URT-ven" },
                { english: "Sixty", hungarian: "hatvan", alternatives: [], hint: "HOT-van" },
                { english: "Seventy", hungarian: "hetven", alternatives: [], hint: "HET-ven" },
                { english: "Eighty", hungarian: "nyolcvan", alternatives: [], hint: "NYOLTS-van" },
                { english: "Ninety", hungarian: "kilencven", alternatives: [], hint: "KEE-lents-ven" },
                { english: "One hundred", hungarian: "sz√°z", alternatives: ["szaz"], hint: "Like 'sauce'" }
            ],

            daily: [
                { english: "House", hungarian: "h√°z", alternatives: ["haz"], hint: "Sounds like 'house'" },
                { english: "Food", hungarian: "√©tel", alternatives: ["etel"], hint: "AY-tel" },
                { english: "Water", hungarian: "v√≠z", alternatives: ["viz"], hint: "Like 'vees'" },
                { english: "Bread", hungarian: "keny√©r", alternatives: ["kenyer"], hint: "KEN-yair" },
                { english: "Milk", hungarian: "tej", alternatives: [], hint: "Like 'tay'" },
                { english: "Coffee", hungarian: "k√°v√©", alternatives: ["kave"], hint: "KAH-vay" },
                { english: "Tea", hungarian: "tea", alternatives: [], hint: "Same as English" },
                { english: "Book", hungarian: "k√∂nyv", alternatives: ["konyv"], hint: "KURN-yiv" },
                { english: "Car", hungarian: "aut√≥", alternatives: ["auto"], hint: "AH-oo-toe" },
                { english: "Money", hungarian: "p√©nz", alternatives: ["penz"], hint: "Like 'pains'" },
                { english: "Time", hungarian: "id≈ë", alternatives: ["ido"], hint: "EE-doe" },
                { english: "Work", hungarian: "munka", alternatives: [], hint: "MOON-ka" },
                { english: "School", hungarian: "iskola", alternatives: [], hint: "ISH-ko-la" },
                { english: "Family", hungarian: "csal√°d", alternatives: ["csalad"], hint: "CHA-lahd" },
                { english: "Friend", hungarian: "bar√°t", alternatives: ["barat"], hint: "BAH-raht" },
                { english: "Love", hungarian: "szerelem", alternatives: [], hint: "SE-re-lem" },
                { english: "Happy", hungarian: "boldog", alternatives: [], hint: "BOWL-dog" },
                { english: "Sad", hungarian: "szomor√∫", alternatives: ["szomoru"], hint: "SO-mo-roo" },
                { english: "Beautiful", hungarian: "sz√©p", alternatives: ["szep"], hint: "Like 'shape'" },
                { english: "Good", hungarian: "j√≥", alternatives: ["jo"], hint: "Like 'yo'" }
            ],

            time: [
                { english: "Monday", hungarian: "h√©tf≈ë", alternatives: ["hetfo"], hint: "HATE-foe" },
                { english: "Tuesday", hungarian: "kedd", alternatives: [], hint: "Like 'ked'" },
                { english: "Wednesday", hungarian: "szerda", alternatives: [], hint: "SER-da" },
                { english: "Thursday", hungarian: "cs√ºt√∂rt√∂k", alternatives: ["csutortok"], hint: "CHEW-tur-turk" },
                { english: "Friday", hungarian: "p√©ntek", alternatives: ["pentek"], hint: "PAIN-tek" },
                { english: "Saturday", hungarian: "szombat", alternatives: [], hint: "SOME-bot" },
                { english: "Sunday", hungarian: "vas√°rnap", alternatives: ["vasarnap"], hint: "VAH-shar-nop" },
                { english: "Today", hungarian: "ma", alternatives: [], hint: "Very short: 'ma'" },
                { english: "Tomorrow", hungarian: "holnap", alternatives: [], hint: "HOLE-nop" },
                { english: "Yesterday", hungarian: "tegnap", alternatives: [], hint: "TEG-nop" },
                { english: "Morning", hungarian: "reggel", alternatives: [], hint: "REG-gel" },
                { english: "Afternoon", hungarian: "d√©lut√°n", alternatives: ["delutan"], hint: "DALE-oo-tahn" },
                { english: "Evening", hungarian: "este", alternatives: [], hint: "ESH-te" },
                { english: "Night", hungarian: "√©jszaka", alternatives: ["ejszaka"], hint: "AY-sa-ka" },
                { english: "Hour", hungarian: "√≥ra", alternatives: ["ora"], hint: "OH-ra" },
                { english: "Minute", hungarian: "perc", alternatives: [], hint: "Like 'perts'" },
                { english: "Week", hungarian: "h√©t", alternatives: ["het"], hint: "Like 'hate'" },
                { english: "Month", hungarian: "h√≥nap", alternatives: ["honap"], hint: "HOE-nop" }
            ]
        };

        let currentQuestion = 0;
        let score = 0;
        let streak = 0;
        let bestStreak = 0;
        let shuffledQuestions = [];
        let currentCategory = '';
        let settings = {
            timer: false,
            hints: true,
            difficulty: 'easy',
            timeLimit: 30
        };
        let timer = null;
        let timeLeft = 30;
        let totalAnswered = 0;
        let totalCorrect = 0;
        let hintShown = false;

        // Load stats from localStorage
        function loadStats() {
            const stats = JSON.parse(localStorage.getItem('hungarianQuizStats') || '{}');
            totalAnswered = stats.totalAnswered || 0;
            totalCorrect = stats.totalCorrect || 0;
            bestStreak = stats.bestStreak || 0;
            updateStatsDisplay();
        }

        function saveStats() {
            const stats = {
                totalAnswered,
                totalCorrect,
                bestStreak
            };
            localStorage.setItem('hungarianQuizStats', JSON.stringify(stats));
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            document.getElementById('total-questions').textContent = totalAnswered;
            document.getElementById('accuracy-rate').textContent = 
                totalAnswered > 0 ? Math.round((totalCorrect / totalAnswered) * 100) + '%' : '0%';
            document.getElementById('best-streak').textContent = bestStreak;
        }

        // Settings functions
        function toggleTimer() {
            settings.timer = !settings.timer;
            const toggle = document.getElementById('timer-toggle');
            toggle.classList.toggle('active');
        }

        function toggleHints() {
            settings.hints = !settings.hints;
            const toggle = document.getElementById('hints-toggle');
            toggle.classList.toggle('active');
        }

        function setDifficulty(level) {
            settings.difficulty = level;
            document.querySelectorAll('.difficulty-option').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Adjust time limits based on difficulty
            switch(level) {
                case 'easy': settings.timeLimit = 45; break;
                case 'medium': settings.timeLimit = 30; break;
                case 'hard': settings.timeLimit = 15; break;
            }
        }

        // Timer functions
        function startTimer() {
            if (!settings.timer) return;
            
            timeLeft = settings.timeLimit;
            updateTimerDisplay();
            document.getElementById('timer-display').classList.remove('hidden');
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 5) {
                    document.getElementById('timer-display').classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    skipQuestion();
                }
            }, 1000);
        }

        function stopTimer() {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
        }

        function updateTimerDisplay() {
            document.getElementById('time-left').textContent = timeLeft;
        }

        function resetTimer() {
            stopTimer();
            document.getElementById('timer-display').classList.remove('warning');
            document.getElementById('timer-display').classList.add('hidden');
        }

        function getAllQuestions() {
            return [...questionSets.greetings, ...questionSets.numbers, ...questionSets.daily, ...questionSets.time];
        }

        function getRandomMix() {
            const allQuestions = getAllQuestions();
            const shuffled = shuffleArray(allQuestions);
            return shuffled.slice(0, 20);
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startQuiz(category) {
            currentCategory = category;
            hintShown = false;
            
            switch(category) {
                case 'greetings':
                    shuffledQuestions = shuffleArray(questionSets.greetings);
                    document.getElementById('current-category').textContent = 'üëã Greetings & Expressions';
                    break;
                case 'numbers':
                    shuffledQuestions = shuffleArray(questionSets.numbers);
                    document.getElementById('current-category').textContent = 'üî¢ Numbers & Counting';
                    break;
                case 'daily':
                    shuffledQuestions = shuffleArray(questionSets.daily);
                    document.getElementById('current-category').textContent = 'üè† Daily Life';
                    break;
                case 'time':
                    shuffledQuestions = shuffleArray(questionSets.time);
                    document.getElementById('current-category').textContent = '‚è∞ Time & Dates';
                    break;
                case 'random':
                    shuffledQuestions = getRandomMix();
                    document.getElementById('current-category').textContent = 'üé≤ Mixed Practice';
                    break;
                case 'all':
                    shuffledQuestions = shuffleArray(getAllQuestions());
                    document.getElementById('current-category').textContent = 'üìö Complete Assessment';
                    break;
            }
            
            currentQuestion = 0;
            score = 0;
            streak = 0;
            updateScore();
            updateProgress();
            showQuestion();
            
            document.getElementById('start-menu').classList.add('hidden');
            document.getElementById('quiz-section').classList.remove('hidden');
            document.getElementById('completion').classList.add('hidden');
        }

        function backToMenu() {
            resetTimer();
            document.getElementById('start-menu').classList.remove('hidden');
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('completion').classList.add('hidden');
        }

        function showQuestion() {
            const question = shuffledQuestions[currentQuestion];
            document.getElementById('english-phrase').textContent = question.english;
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('hint-container').classList.add('hidden');
            
            // Show/hide hint button based on settings
            document.getElementById('hint-btn').style.display = settings.hints ? 'inline-block' : 'none';
            hintShown = false;
            
            updateProgress();
            startTimer();
        }

        function showHint() {
            if (!settings.hints || hintShown) return;
            
            const question = shuffledQuestions[currentQuestion];
            document.getElementById('hint-text').textContent = question.hint;
            document.getElementById('hint-container').classList.remove('hidden');
            hintShown = true;
        }

        function normalizeString(str) {
            return str.toLowerCase().trim().replace(/[?!.,]/g, '');
        }

        function checkAnswer() {
            stopTimer();
            totalAnswered++;
            
            const userAnswer = document.getElementById('answer-input').value;
            const question = shuffledQuestions[currentQuestion];
            const normalizedUser = normalizeString(userAnswer);
            const normalizedCorrect = normalizeString(question.hungarian);
            
            const isCorrect = normalizedUser === normalizedCorrect || 
                              question.alternatives.some(alt => normalizeString(alt) === normalizedUser);

            const feedback = document.getElementById('feedback');
            
            if (isCorrect) {
                score++;
                totalCorrect++;
                streak++;
                if (streak > bestStreak) {
                    bestStreak = streak;
                }
                
                feedback.textContent = `‚úÖ Correct! "${question.hungarian}"`;
                feedback.className = 'feedback correct';
                
                // Add bonus points for not using hints
                if (!hintShown && settings.hints) {
                    feedback.textContent += ' (+1 bonus for no hint!)';
                }
            } else {
                streak = 0;
                feedback.textContent = `‚ùå Incorrect. The correct answer is: "${question.hungarian}"`;
                feedback.className = 'feedback incorrect';
            }
            
            feedback.classList.remove('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            updateScore();
            saveStats();
        }

        function skipQuestion() {
            stopTimer();
            totalAnswered++;
            streak = 0;
            
            const question = shuffledQuestions[currentQuestion];
            const feedback = document.getElementById('feedback');
            feedback.textContent = `‚è≠Ô∏è Skipped. The answer was: "${question.hungarian}"`;
            feedback.className = 'feedback incorrect';
            feedback.classList.remove('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            saveStats();
        }

        function nextQuestion() {
            resetTimer();
            currentQuestion++;
            if (currentQuestion < shuffledQuestions.length) {
                showQuestion();
            } else {
                showCompletion();
            }
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('total').textContent = shuffledQuestions.length;
            document.getElementById('streak-display').textContent = `üî• ${streak}`;
        }

        function updateProgress() {
            const progress = (currentQuestion / shuffledQuestions.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
            document.getElementById('progress-text').textContent = Math.round(progress) + '%';
        }

        function showCompletion() {
            const percentage = Math.round((score / shuffledQuestions.length) * 100);
            let message = `You scored ${score} out of ${shuffledQuestions.length} (${percentage}%)!`;
            
            if (percentage >= 95) {
                message += " üèÜ Perfect! You're a Hungarian master!";
            } else if (percentage >= 85) {
                message += " üåü Excellent work! Almost perfect!";
            } else if (percentage >= 70) {
                message += " üëè Great job! Keep practicing!";
            } else if (percentage >= 50) {
                message += " üëç Good effort! Room for improvement!";
            } else {
                message += " üìö Keep studying! Practice makes perfect!";
            }

            document.getElementById('final-score').textContent = message;
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('completion').classList.remove('hidden');
        }

        function restartQuiz() {
            startQuiz(currentCategory);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !document.getElementById('quiz-section').classList.contains('hidden')) {
                if (!document.getElementById('next-btn').classList.contains('hidden')) {
                    nextQuestion();
                } else {
                    checkAnswer();
                }
            }
            
            if (event.key === 'h' && event.ctrlKey && settings.hints) {
                event.preventDefault();
                showHint();
            }
            
            if (event.key === 's' && event.ctrlKey) {
                event.preventDefault();
                skipQuestion();
            }
        });

        // Initialize
        loadStats();
    </script>
</body>
</html>