<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Wishing Tree</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #7c8ff0, #8a5bb0);
        }

        /* Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: #667eea rgba(255, 255, 255, 0.03);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            color: #fff;
        }

        .gradient-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 107, 107, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 90%, rgba(72, 219, 251, 0.2) 0%, transparent 50%),
                #0a0a0a;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { transform: scale(1) translate(0, 0); }
            50% { transform: scale(1.1) translate(5%, 5%); }
        }

        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            z-index: 1;
            pointer-events: none;
            background-image: url('data:image/svg+xml,%3Csvg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noise"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" /%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noise)" /%3E%3C/svg%3E');
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 2;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
        }

        .logo {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -2px;
        }

        .tagline {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 400;
        }

        .bento-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
            margin-bottom: 40px;
        }

        .bento-item {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 32px;
            padding: 40px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .bento-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 255, 255, 0.06) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .bento-item:hover::before {
            opacity: 1;
        }

        .form-container {
            grid-column: span 5;
        }

        .tree-container {
            grid-column: span 7;
            min-height: 700px;
            position: relative;
        }

        .calendar-container {
            grid-column: span 12;
            padding: 32px;
        }

        .form-header {
            margin-bottom: 32px;
        }

        .form-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .form-subtitle {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.95rem;
        }

        .input-group {
            margin-bottom: 24px;
        }

        .label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, textarea {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.04);
            border: 1.5px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        input:focus, textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        textarea {
            min-height: 140px;
            resize: vertical;
        }

        .meta-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            font-size: 0.875rem;
        }

        .char-count {
            color: rgba(255, 255, 255, 0.4);
        }

        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #fff;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        .color-option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-weight: bold;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            margin-top: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 16px;
            color: #fff;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .tree {
            position: relative;
            width: 100%;
            height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tree-trunk {
            width: 100px;
            height: 200px;
            background: linear-gradient(to right, #4a3728, #6b4e3d, #4a3728);
            border-radius: 12px;
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 
                inset -10px 0 20px rgba(0, 0, 0, 0.5),
                0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .tree-crown {
            position: absolute;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
        }

        .crown-layer {
            width: 0;
            height: 0;
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-bottom: 300px solid #1a4d2e;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.4));
            position: relative;
        }

        .crown-layer::before {
            content: '';
            width: 0;
            height: 0;
            border-left: 180px solid transparent;
            border-right: 180px solid transparent;
            border-bottom: 260px solid #2d5f3f;
            position: absolute;
            top: 80px;
            left: -180px;
        }

        .crown-layer::after {
            content: '';
            width: 0;
            height: 0;
            border-left: 160px solid transparent;
            border-right: 160px solid transparent;
            border-bottom: 220px solid #3d7450;
            position: absolute;
            top: 150px;
            left: -160px;
        }

        .wishes-area {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .wish-card {
            position: absolute;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            padding: 20px 24px;
            border-radius: 20px;
            max-width: 260px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .wish-card::before {
            content: '';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 30px;
            background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.3));
        }

        .wish-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
            z-index: 100;
        }

        .wish-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wish-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.875rem;
            line-height: 1.6;
            margin-bottom: 12px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .wish-content.truncated {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .read-more {
            color: #667eea;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            display: inline-block;
        }

        .wish-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Calendar Styles */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .calendar-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .calendar-nav {
            display: flex;
            gap: 12px;
        }

        .calendar-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
        }

        .calendar-day-label {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.875rem;
            font-weight: 600;
            padding: 12px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            padding: 12px;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }

        .calendar-day.empty:hover {
            transform: none;
        }

        .calendar-day.has-wish {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border-color: rgba(102, 126, 234, 0.3);
        }

        .calendar-day.has-wish::after {
            content: '';
            position: absolute;
            bottom: 8px;
            width: 6px;
            height: 6px;
            background: #667eea;
            border-radius: 50%;
        }

        .calendar-day-number {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }

        .calendar-day-count {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
        }

        .wish-floating {
            position: fixed;
            padding: 24px 28px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.9));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 20px 60px rgba(255, 215, 0, 0.4),
                0 0 80px rgba(255, 215, 0, 0.2);
            z-index: 10000;
            pointer-events: none;
            animation: floatToTree 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .wish-floating .wish-content {
            color: #1a1a1a;
            font-weight: 600;
        }

        @keyframes floatToTree {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1) rotate(0deg);
            }
            30% {
                transform: translate(var(--dx1), var(--dy1)) scale(0.8) rotate(180deg);
            }
            60% {
                transform: translate(var(--dx2), var(--dy2)) scale(0.5) rotate(360deg);
            }
            100% {
                opacity: 0;
                transform: translate(var(--target-x), var(--target-y)) scale(0) rotate(540deg);
            }
        }

        .particle {
            position: fixed;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, #ffd700, #ff8c00);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: particleBurst 1.2s ease-out forwards;
            box-shadow: 0 0 10px currentColor;
        }

        @keyframes particleBurst {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--px), var(--py)) scale(0);
                opacity: 0;
            }
        }

        @keyframes wishReveal {
            0% {
                opacity: 0;
                transform: scale(0) rotate(-90deg) translateY(50px);
            }
            70% {
                transform: scale(1.1) rotate(5deg) translateY(0);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0) translateY(0);
            }
        }

        .wish-card.revealing {
            animation: wishReveal 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .toast {
            position: fixed;
            top: 40px;
            right: 40px;
            background: rgba(16, 185, 129, 0.95);
            backdrop-filter: blur(20px);
            color: #fff;
            padding: 20px 28px;
            border-radius: 16px;
            font-weight: 600;
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
            z-index: 10001;
            transform: translateX(500px);
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 32px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalAppear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 24px;
            right: 24px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            z-index: 1;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-date-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        .wishes-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .wish-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .wish-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateX(8px);
        }

        .wish-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .wish-item-name {
            font-weight: 600;
            font-size: 1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wish-item-time {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .wish-item-preview {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .modal-wish-content {
            margin-top: 24px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .single-wish-view {
            display: none;
        }

        .single-wish-view.active {
            display: block;
        }

        .wishes-list-view {
            display: none;
        }

        .wishes-list-view.active {
            display: block;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 10px 20px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .single-wish-view .back-btn {
            display: inline-flex;
        }

        .wishes-list-view .back-btn {
            display: none;
        }

        @media (max-width: 1200px) {
            .form-container, .tree-container {
                grid-column: span 12;
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 2rem;
            }

            .bento-item {
                padding: 24px;
            }

            .calendar-grid {
                gap: 8px;
            }

            .calendar-day {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="gradient-bg"></div>
    <div class="noise"></div>

    <div class="container">
        <header>
            <div class="logo">our wish tree</div>
            <div class="tagline">where dreams take root together</div>
        </header>

        <div class="bento-grid">
            <div class="bento-item form-container">
                <div class="form-header">
                    <div class="form-title">plant a wish</div>
                    <div class="form-subtitle">share what's in your heart</div>
                </div>

                <form id="wishForm">
                    <div class="input-group">
                        <label class="label">name</label>
                        <input type="text" id="nameInput" placeholder="who's wishing?" required>
                    </div>

                    <div class="input-group">
                        <label class="label">your wish</label>
                        <textarea id="wishInput" placeholder="write your wish for us..." required></textarea>
                        <div class="meta-info">
                            <span class="char-count"><span id="charCount">0</span> characters</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="label">card color</label>
                        <div class="color-picker">
                            <div class="color-option selected" data-color="rgba(254, 202, 202, 0.95)" style="background: rgba(254, 202, 202, 0.95);"></div>
                            <div class="color-option" data-color="rgba(191, 219, 254, 0.95)" style="background: rgba(191, 219, 254, 0.95);"></div>
                            <div class="color-option" data-color="rgba(254, 240, 138, 0.95)" style="background: rgba(254, 240, 138, 0.95);"></div>
                            <div class="color-option" data-color="rgba(196, 181, 253, 0.95)" style="background: rgba(196, 181, 253, 0.95);"></div>
                            <div class="color-option" data-color="rgba(167, 243, 208, 0.95)" style="background: rgba(167, 243, 208, 0.95);"></div>
                            <div class="color-option" data-color="rgba(251, 207, 232, 0.95)" style="background: rgba(251, 207, 232, 0.95);"></div>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn">
                        <span>send to tree ‚ú®</span>
                    </button>
                </form>
            </div>

            <div class="bento-item tree-container">
                <div class="tree">
                    <div class="tree-crown">
                        <div class="crown-layer"></div>
                    </div>
                    <div class="tree-trunk"></div>
                    <div class="wishes-area" id="wishesArea"></div>
                </div>
            </div>

            <div class="bento-item calendar-container">
                <div class="calendar-header">
                    <div class="calendar-title" id="calendarTitle">January 2025</div>
                    <div class="calendar-nav">
                        <button class="calendar-btn" id="prevMonth">‚Üê Prev</button>
                        <button class="calendar-btn" id="nextMonth">Next ‚Üí</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">wish planted successfully! üå±</div>

    <div class="modal" id="wishModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">√ó</button>
            
            <!-- List view for multiple wishes -->
            <div class="wishes-list-view" id="wishesListView">
                <div class="modal-header">
                    <div class="modal-date-title" id="modalDateTitle"></div>
                    <div class="modal-subtitle" id="modalSubtitle"></div>
                </div>
                <div class="wishes-list" id="wishesList"></div>
            </div>
            
            <!-- Single wish view -->
            <div class="single-wish-view" id="singleWishView">
                <button class="back-btn" id="backBtn">‚Üê Back to list</button>
                <div class="wish-name" id="modalName"></div>
                <div class="modal-wish-content" id="modalContent"></div>
                <div class="wish-footer">
                    <span id="modalDate"></span>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
                apiKey: "AIzaSyArZvb5mNy9DO9btjY-xz9ljcKcLIEsW-A",
                authDomain: "wishingtree-92300.firebaseapp.com",
                databaseURL: "https://wishingtree-92300-default-rtdb.europe-west1.firebasedatabase.app",
                projectId: "wishingtree-92300",
                storageBucket: "wishingtree-92300.firebasestorage.app",
                messagingSenderId: "347275510131",
                appId: "1:347275510131:web:2e3db1a3c74fb49676c506",
                measurementId: "G-P53BDS8C87"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const wishesRef = ref(database, 'wishes');

        const form = document.getElementById('wishForm');
        const nameInput = document.getElementById('nameInput');
        const wishInput = document.getElementById('wishInput');
        const charCount = document.getElementById('charCount');
        const wishesArea = document.getElementById('wishesArea');
        const toast = document.getElementById('toast');
        const modal = document.getElementById('wishModal');
        const modalClose = document.getElementById('modalClose');
        const modalName = document.getElementById('modalName');
        const modalContent = document.getElementById('modalContent');
        const modalDate = document.getElementById('modalDate');
        const wishesListView = document.getElementById('wishesListView');
        const singleWishView = document.getElementById('singleWishView');
        const modalDateTitle = document.getElementById('modalDateTitle');
        const modalSubtitle = document.getElementById('modalSubtitle');
        const wishesList = document.getElementById('wishesList');
        const backBtn = document.getElementById('backBtn');
        const calendarGrid = document.getElementById('calendarGrid');
        const calendarTitle = document.getElementById('calendarTitle');
        const prevMonth = document.getElementById('prevMonth');
        const nextMonth = document.getElementById('nextMonth');

        let startTime = null;
        let isTyping = false;
        let selectedColor = 'rgba(254, 202, 202, 0.95)';
        let currentDate = new Date();
        let allWishes = [];

        const positions = [
            { top: '8%', left: '22%' },
            { top: '15%', right: '18%' },
            { top: '25%', left: '12%' },
            { top: '32%', right: '10%' },
            { top: '42%', left: '8%' },
            { top: '45%', right: '8%' },
            { top: '18%', left: '45%' },
            { top: '35%', right: '38%' },
            { top: '52%', left: '18%' },
            { top: '55%', right: '22%' },
        ];

        let posIndex = 0;

        // Color picker
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                selectedColor = option.dataset.color;
            });
        });

        // Glassmorphism hover effect
        document.querySelectorAll('.bento-item').forEach(item => {
            item.addEventListener('mousemove', (e) => {
                const rect = item.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                item.style.setProperty('--mouse-x', x + '%');
                item.style.setProperty('--mouse-y', y + '%');
            });
        });

        wishInput.addEventListener('input', (e) => {
            if (!isTyping && e.target.value.length > 0) {
                startTime = Date.now();
                isTyping = true;
            }
            charCount.textContent = e.target.value.length;
        });

        function createParticles(x, y, count = 20) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                const angle = (Math.PI * 2 * i) / count;
                const distance = 80 + Math.random() * 60;
                const px = Math.cos(angle) * distance;
                const py = Math.sin(angle) * distance;
                
                particle.style.setProperty('--px', px + 'px');
                particle.style.setProperty('--py', py + 'px');
                
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1200);
            }
        }

        function animateWishToTree(wishData, callback) {
            const formRect = form.getBoundingClientRect();
            const treeRect = wishesArea.getBoundingClientRect();
            
            const startX = formRect.left + formRect.width / 2;
            const startY = formRect.top + formRect.height / 2;
            const endX = treeRect.left + treeRect.width / 2;
            const endY = treeRect.top + treeRect.height / 2;
            
            const floating = document.createElement('div');
            floating.className = 'wish-floating';
            floating.style.left = startX + 'px';
            floating.style.top = startY + 'px';
            floating.innerHTML = `<div class="wish-content">${wishData.wish.substring(0, 40)}...</div>`;
            
            const dx1 = (endX - startX) * 0.3;
            const dy1 = (endY - startY) * 0.3 - 150;
            const dx2 = (endX - startX) * 0.7;
            const dy2 = (endY - startY) * 0.7 - 100;
            
            floating.style.setProperty('--dx1', dx1 + 'px');
            floating.style.setProperty('--dy1', dy1 + 'px');
            floating.style.setProperty('--dx2', dx2 + 'px');
            floating.style.setProperty('--dy2', dy2 + 'px');
            floating.style.setProperty('--target-x', (endX - startX) + 'px');
            floating.style.setProperty('--target-y', (endY - startY) + 'px');
            
            document.body.appendChild(floating);
            createParticles(startX, startY);
            
            setTimeout(() => {
                createParticles(endX, endY, 30);
                floating.remove();
                if (callback) callback();
            }, 2000);
        }

        function createWishCard(wishData) {
            const card = document.createElement('div');
            card.className = 'wish-card';
            
            const pos = positions[posIndex % positions.length];
            posIndex++;
            Object.assign(card.style, pos);
            
            if (wishData.color) {
                card.style.background = wishData.color;
            }
            
            const isLong = wishData.wish.length > 150;
            
            card.innerHTML = `
                <div class="wish-name">${wishData.name}</div>
                <div class="wish-content ${isLong ? 'truncated' : ''}" data-full-text="${wishData.wish}">${wishData.wish}</div>
                ${isLong ? '<span class="read-more">Read more...</span>' : ''}
                <div class="wish-footer">
                    <span>${wishData.date}</span>
                </div>
            `;
            
            if (isLong) {
                card.querySelector('.read-more').addEventListener('click', (e) => {
                    e.stopPropagation();
                    currentDayWishes = [wishData];
                    currentDateString = wishData.date;
                    showModal(wishData);
                });
            }
            
            card.addEventListener('click', () => {
                currentDayWishes = [wishData];
                currentDateString = wishData.date;
                showModal(wishData);
            });
            
            return card;
        }

        let currentDayWishes = [];
        let currentDateString = '';

        function showModal(wishData) {
            modalName.textContent = wishData.name;
            modalContent.textContent = wishData.wish;
            modalDate.textContent = wishData.date;
            wishesListView.classList.remove('active');
            singleWishView.classList.add('active');
            modal.classList.add('active');
        }

        function showWishesList(wishes, dateStr) {
            currentDayWishes = wishes;
            currentDateString = dateStr;
            
            wishesList.innerHTML = '';
            modalDateTitle.textContent = dateStr;
            modalSubtitle.textContent = `${wishes.length} wish${wishes.length > 1 ? 'es' : ''} on this day`;
            
            wishes.forEach(wish => {
                const wishItem = document.createElement('div');
                wishItem.className = 'wish-item';
                
                const time = new Date(wish.timestamp).toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                wishItem.innerHTML = `
                    <div class="wish-item-header">
                        <div class="wish-item-name">${wish.name}</div>
                        <div class="wish-item-time">${time}</div>
                    </div>
                    <div class="wish-item-preview">${wish.wish}</div>
                `;
                
                wishItem.addEventListener('click', () => {
                    showModal(wish);
                });
                
                wishesList.appendChild(wishItem);
            });
            
            singleWishView.classList.remove('active');
            wishesListView.classList.add('active');
            modal.classList.add('active');
        }

        backBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentDayWishes.length > 1) {
                singleWishView.classList.remove('active');
                wishesListView.classList.add('active');
            } else {
                modal.classList.remove('active');
            }
        });

        modalClose.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });

        function renderCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            calendarTitle.textContent = `${monthNames[month]} ${year}`;
            calendarGrid.innerHTML = '';
            
            // Day labels
            const dayLabels = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayLabels.forEach(label => {
                const dayLabel = document.createElement('div');
                dayLabel.className = 'calendar-day-label';
                dayLabel.textContent = label;
                calendarGrid.appendChild(dayLabel);
            });
            
            // Empty cells before first day
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Count wishes per day
            const wishCountByDay = {};
            allWishes.forEach(wish => {
                const wishDate = new Date(wish.timestamp);
                if (wishDate.getFullYear() === year && wishDate.getMonth() === month) {
                    const day = wishDate.getDate();
                    wishCountByDay[day] = (wishCountByDay[day] || 0) + 1;
                }
            });
            
            // Actual days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                const wishCount = wishCountByDay[day] || 0;
                if (wishCount > 0) {
                    dayCell.classList.add('has-wish');
                }
                
                dayCell.innerHTML = `
                    <div class="calendar-day-number">${day}</div>
                    ${wishCount > 0 ? `<div class="calendar-day-count">${wishCount} wish${wishCount > 1 ? 'es' : ''}</div>` : ''}
                `;
                
                dayCell.addEventListener('click', () => {
                    const dayWishes = allWishes.filter(wish => {
                        const wishDate = new Date(wish.timestamp);
                        return wishDate.getFullYear() === year && 
                               wishDate.getMonth() === month && 
                               wishDate.getDate() === day;
                    });
                    
                    if (dayWishes.length > 0) {
                        const dateStr = new Date(year, month, day).toLocaleDateString('en-US', { 
                            weekday: 'long',
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                        
                        if (dayWishes.length === 1) {
                            showModal(dayWishes[0]);
                        } else {
                            showWishesList(dayWishes, dateStr);
                        }
                    }
                });
                
                calendarGrid.appendChild(dayCell);
            }
        }

        prevMonth.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
        });

        nextMonth.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
        });

        onValue(wishesRef, (snapshot) => {
            wishesArea.innerHTML = '';
            posIndex = 0;
            allWishes = [];
            
            snapshot.forEach((child) => {
                allWishes.push(child.val());
            });
            
            allWishes.forEach((wishData, i) => {
                const card = createWishCard(wishData);
                wishesArea.appendChild(card);
                
                setTimeout(() => {
                    card.classList.add('revealing');
                }, i * 150);
            });
            
            renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = nameInput.value.trim();
            const wish = wishInput.value.trim();
            
            if (!name || !wish) return;
            
            const finalTime = isTyping 
                ? Math.floor((Date.now() - startTime) / 1000)
                : 0;
            
            const wishData = {
                name,
                wish,
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                timestamp: Date.now(),
                timeSpent: finalTime,
                color: selectedColor
            };
            
            try {
                animateWishToTree(wishData, () => {
                    toast.classList.add('show');
                    setTimeout(() => toast.classList.remove('show'), 3000);
                });
                
                await push(wishesRef, wishData);
                
                form.reset();
                charCount.textContent = '0';
                isTyping = false;
                startTime = null;
                document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
                document.querySelector('.color-option').classList.add('selected');
                selectedColor = 'rgba(254, 202, 202, 0.95)';
                
            } catch (error) {
                console.error('Error:', error);
            }
        });

        renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
    </script>
</body>
</html>