<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Generative Art</title>
  <style>
    body {
      margin: 0;
      background: #0d0d0d;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: white;
      font-family: monospace;
    }
    canvas {
      border: 2px solid white;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
      margin-bottom: 10px;
      background: #000;
    }
  </style>
</head>
<body>
  <canvas id="myCanvas" width="900" height="600"></canvas>
  <div id="stats"></div>

  <script>
    const filePath = "data.cx"; // number list

    // === RNG ===
    function mulberry32(seed) {
      return function () {
        let t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }

    // === Helpers ===
    function isPrime(n) {
      if (n < 2) return false;
      for (let i = 2; i * i <= n; i++) {
        if (n % i === 0) return false;
      }
      return true;
    }

    function drawStar(ctx, x, y, spikes, outerR, innerR, color) {
      let rot = Math.PI / 2 * 3;
      let step = Math.PI / spikes;
      ctx.beginPath();
      ctx.moveTo(x, y - outerR);
      for (let i = 0; i < spikes; i++) {
        ctx.lineTo(x + Math.cos(rot) * outerR, y + Math.sin(rot) * outerR);
        rot += step;
        ctx.lineTo(x + Math.cos(rot) * innerR, y + Math.sin(rot) * innerR);
        rot += step;
      }
      ctx.lineTo(x, y - outerR);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();
    }

    // === Analysis ===
    function randomizedAnalysis(numbers, rand) {
      const sampleSize = Math.max(5, Math.floor(rand() * numbers.length));
      const shuffled = [...numbers].sort(() => rand() - 0.5);
      const subset = shuffled.slice(0, sampleSize);

      const sum = subset.reduce((a, b) => a + b, 0);
      const avg = sum / subset.length;
      const min = Math.min(...subset);
      const max = Math.max(...subset);
      const variance = subset.reduce((a, b) => a + Math.pow(b - avg, 2), 0) / subset.length;

      return { sum, avg, min, max, variance, count: subset.length, subset };
    }

    // === Draw ===
    function drawArt(numbers, stats, rand) {
      const canvas = document.getElementById("myCanvas");
      const ctx = canvas.getContext("2d");

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let n of stats.subset) {
        const x = rand() * canvas.width;
        const y = rand() * canvas.height;
        const size = 5 + (n % 40) * (stats.avg / 100);
        const color = `hsl(${(n * 3) % 360}, 70%, ${30 + (stats.variance % 50)}%)`;

        if (isPrime(n)) {
          drawStar(ctx, x, y, 5, size, size / 2, color);
        } else if (n % 2 === 0) {
          ctx.beginPath();
          ctx.arc(x, y, size, 0, Math.PI * 2);
          ctx.fillStyle = color;
          ctx.fill();
        } else if (n % 5 === 0) {
          ctx.beginPath();
          ctx.moveTo(x - size, y - size);
          ctx.lineTo(x + size, y + size);
          ctx.strokeStyle = color;
          ctx.lineWidth = 2;
          ctx.stroke();
        } else {
          ctx.fillStyle = color;
          ctx.fillRect(x - size / 2, y - size / 2, size, size);
        }
      }

      // Show stats
      document.getElementById("stats").innerHTML =
        `Subset size: ${stats.count} | Avg: ${stats.avg.toFixed(2)} | Var: ${stats.variance.toFixed(2)}`;
    }

    // === Main ===
    fetch(filePath)
      .then(res => res.text())
      .then(text => {
        const numbers = (text.match(/\d+/g) || []).map(Number);
        if (numbers.length === 0) {
          alert("No numbers found in file!");
          return;
        }

        // auto-randomize seed with file + time
        const seedBase = numbers.reduce((a, b) => a + b, 0);
        const seed = seedBase ^ Date.now();
        const rand = mulberry32(seed);

        const stats = randomizedAnalysis(numbers, rand);
        drawArt(numbers, stats, rand);
      });
  </script>
</body>
</html>
